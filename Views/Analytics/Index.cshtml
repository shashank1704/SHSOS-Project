@{
    ViewData["Title"] = "Analytics & Reports";
}

<div class="fade-in">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <h1 style="font-weight: 700; color: var(--primary);">ğŸ“ˆ Analytics & Reports</h1>
            <p style="color: var(--text-secondary);">Comprehensive environmental impact analysis and forecasting</p>
        </div>
    </div>

    <!-- Top Grid of Metrics (Pictorial) -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 107, 0, 0.1); color: #ff6b00;">ğŸ“ˆ</div>
                <div class="stat-info">
                    <span class="label">Total Energy Cost</span>
                    <span class="value">â‚¹@Math.Round((decimal)ViewBag.TotalEnergyCost, 0)</span>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(155, 89, 182, 0.1); color: #9b59b6;">ğŸ“¦</div>
                <div class="stat-info">
                    <span class="label">Total Waste Cost</span>
                    <span class="value">â‚¹@Math.Round((decimal)ViewBag.TotalWasteCost, 0)</span>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(46, 204, 113, 0.1); color: #2ecc71;">ğŸŒ</div>
                <div class="stat-info">
                    <span class="label">Carbon Footprint</span>
                    <span class="value">@Math.Round((decimal)ViewBag.TotalCarbon, 0)<small style="font-size: 0.8rem;"> Kg</small></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparative Analysis Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">ğŸ¢ Energy Usage by Department</div>
                <div class="card-body">
                    <canvas id="energyDeptChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">ğŸš¿ Water Distribution per Unit</div>
                <div class="card-body">
                    <canvas id="waterDeptChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Composition Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">ğŸ“Š Waste Material Composition</div>
                <div class="card-body">
                    <canvas id="wasteCategoryChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">ğŸ¯ Unit Sustainability Rankings</div>
                <div class="card-body">
                    <canvas id="sustainabilityChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Future Forecasting -->
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">ğŸ”® Predicted Resource Trend (Next 7 Days)</div>
                <div class="card-body">
                    <canvas id="predictionChart" style="max-height: 350px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        const energyByDept = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.EnergyByDepartment));
        const waterByDept = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.WaterByDepartment));
        const wasteByCategory = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.WasteByCategory));
        const sustainabilityData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.SustainabilityData));
        const predictedEnergy = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.PredictedEnergy));

        // Professional Color Palette
        const palette = ['#ff6b00', '#3498db', '#9b59b6', '#2ecc71', '#f1c40f', '#e67e22', '#e74c3c'];

        // Energy by Department
        new Chart(document.getElementById('energyDeptChart'), {
            type: 'bar',
            data: {
                labels: Object.keys(energyByDept),
                datasets: [{
                    label: 'Units (kWh)',
                    data: Object.values(energyByDept),
                    backgroundColor: 'rgba(255, 107, 0, 0.7)',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // Water by Department
        new Chart(document.getElementById('waterDeptChart'), {
            type: 'bar',
            data: {
                labels: Object.keys(waterByDept),
                datasets: [{
                    label: 'Volume (L)',
                    data: Object.values(waterByDept),
                    backgroundColor: 'rgba(52, 152, 219, 0.7)',
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // Waste Categories
        new Chart(document.getElementById('wasteCategoryChart'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(wasteByCategory),
                datasets: [{
                    data: Object.values(wasteByCategory),
                    backgroundColor: palette,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });

        // Sustainability Scores Radar
        new Chart(document.getElementById('sustainabilityChart'), {
            type: 'radar',
            data: {
                labels: Object.keys(sustainabilityData),
                datasets: [{
                    label: 'Score %',
                    data: Object.values(sustainabilityData),
                    backgroundColor: 'rgba(46, 204, 113, 0.1)',
                    borderColor: '#2ecc71',
                    pointBackgroundColor: '#2ecc71'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: { beginAtZero: true, max: 100 }
                }
            }
        });

        // Combined Prediction Line
        new Chart(document.getElementById('predictionChart'), {
            type: 'line',
            data: {
                labels: predictedEnergy.map(d => new Date(d.Date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
                datasets: [{
                    label: 'Projected Consumption',
                    data: predictedEnergy.map(d => d.PredictedConsumption),
                    borderColor: '#ff6b00',
                    backgroundColor: 'rgba(255, 107, 0, 0.05)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointBackgroundColor: '#ff6b00'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: false, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });
    </script>
}
